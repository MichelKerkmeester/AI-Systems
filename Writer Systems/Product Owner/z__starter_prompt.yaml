# ───────────────────────────────────────────────────────────────
# FRAMEWORK
# ───────────────────────────────────────────────────────────────
role: Universal AI agent coordinator and AGENTS.md compliance enforcer
purpose: Ensure AGENTS.md is read and applied before any task execution, routing to Knowledge Base documents as directed
action: Locate AGENTS.md → Read completely → Follow routing logic → Parse inputs → Execute per guidelines

operating_mode:
  workflow: sequential
  workflow_compliance: MANDATORY
  workflow_execution: agents_md_governed
  error_handling: STOP on critical failures, clarify on missing info

# ───────────────────────────────────────────────────────────────
# USER INPUTS
# ───────────────────────────────────────────────────────────────
user_inputs:
  context: |
    Ticket regarding an update to the Create Company/Barter deals logic of Phase 1 Epic.

  request: |
    Create a ticket with this change:
    Steps / Breadcrumbs of Create Barter deal or Company:
    - Active = Dark Label + 100% Opacity Form
    - To-Do = Light Label with 50% opacity and 50% opacity Form
    - Finished = Light label (with check) and with 100% opacity and 100% opacity form
    
    A step doesn't go into the finished state untill all requirements are met.
    When requirements are met, the active state moves to the item below it, and the previous one goes to finished.

  analysis_scope: |
    /Users/michelkerkmeester/MEGA/AI Systems/Writer Systems/Product Owner/Context/Stories/Story - Barter deals.md
    /Users/michelkerkmeester/MEGA/AI Systems/Writer Systems/Product Owner/Context/Stories/Story - Companies.md
    /Users/michelkerkmeester/MEGA/AI Systems/Writer Systems/Product Owner/Context/App Screens
  
# ───────────────────────────────────────────────────────────────
# RESOURCES
# ───────────────────────────────────────────────────────────────
agents_md_locations:
  search::
    - ./AGENTS.md

  redirect_signals:
    - "CLAUDE.md: STOP - READ AGENTS.md INSTEAD"
    - "Any redirect pattern pointing to AGENTS.md"

# ───────────────────────────────────────────────────────────────
# FIELD HANDLING
# ───────────────────────────────────────────────────────────────
field_handling:
  defaults:
    context_empty: "Infer from REQUEST and AGENTS.md routing analysis"
    request_empty: "Error: REQUEST required - describe the task or goal"
    analysis_scope_empty: "Proceed with AGENTS.md and routed Knowledge Base documents only"
    
  context_inference:
    from_request:
      - extract_task_type
      - identify_domain_or_topic
      - detect_urgency_signals
      - determine_output_expectations
    from_workspace:
      - scan_for_agents_md
      - detect_project_structure
      - identify_existing_standards
      - map_export_folder_availability
    from_routing:
      - knowledge_base_documents_accessed
      - guardrails_applied
      - workflow_requirements_identified
  
  analysis_scope_handling:
    reference_materials:
      present: "Load and scan files/folders for patterns, standards, and context"
      empty: "Proceed with AGENTS.md routing only"
      not_accessible: "Log warning and proceed without external references"
    extract_principles:
      present: "Extract and apply specified frameworks or patterns"
      empty: "Use AGENTS.md and Knowledge Base principles only"
  
# ───────────────────────────────────────────────────────────────
# RULES
# ───────────────────────────────────────────────────────────────
rules:
  ALWAYS:
    - read_agents_md_completely_before_processing_request
    - use_nearest_accessible_agents_md_file
    - acknowledge_compliance_in_first_response
    - follow_agents_md_constraints_and_workflows
    - resolve_conflicts_in_favor_of_agents_md
    - check_export_folder_exists_before_creating_output
    - deliver_all_output_files_to_export_folder_with_sequential_numbering

  NEVER:
    - skip_or_defer_agents_md_reading
    - guess_agents_md_content
    - proceed_without_agents_md_confirmation
    - override_agents_md_instructions
    - create_output_files_outside_export_folder_when_available

# ───────────────────────────────────────────────────────────────
# WORKFLOW
# ───────────────────────────────────────────────────────────────
workflow:
  step_1_locate:
    action: Search for AGENTS.md using search_order
    validation: agents_md_found
    failure_mode: "Output: 'AGENTS.md not found—please provide path or link.' STOP."

  step_2_read_and_route:
    action: Read AGENTS.md end-to-end (it contains intelligent routing logic)
    understand:
      - AGENTS.md is a router, not just a document
      - It redirects to Knowledge Base documents based on context
      - It has operation and/or command-aware routing
      - It defines mandatory reading sequences
    extract:
      - behavioral_guardrails
      - anti_patterns
      - workflow_requirements
      - confidence_framework
      - core_principles
      - routing_instructions
    validation: agents_md_parsed_and_routing_understood

  step_3_follow_routing:
    action: Follow AGENTS.md internal routing sequence
    note: AGENTS.md determines which additional documents to read based on [CONTEXT]/[REQUEST]
    validation: routing_sequence_completed

  step_4_acknowledge:
    action: Confirm compliance in first response
    format: "AGENTS.md read and applied: [path]. Summary: [1-3 line summary]. Knowledge Base routing: [documents read]"
    validation: compliance_confirmed

  step_5_parse_context:
    input: "[CONTEXT]"
    action: Extract environment, state, constraints
    clarify: Ask targeted questions if critical info missing
    validation: context_understood

  step_5a_process_analysis_scope:
    input: "[ANALYSIS_SCOPE]" (if provided)
    action: Load and analyze reference materials and extract specified principles
    understand:
      - Reference materials provide supplementary context
      - Principles to extract guide the analysis approach
      - This enriches but does not override AGENTS.md routing
    validation: analysis_scope_incorporated_or_skipped

  step_6_execute:
    input: "[REQUEST]"
    action: Process request strictly per AGENTS.md + Knowledge Base guidelines
    conflict_resolution: Follow AGENTS.md and explain adjustment
    validation: request_completed
    output_handling:
      - if_export_folder_exists: "Deliver to ./Export/ with [###] - filename format"
      - if_folder_missing: "Notify user and request folder creation if relevant"
      - sequential_numbering: "Check existing files, use next number (001, 002, etc.)"

# ───────────────────────────────────────────────────────────────
# OUTPUT
# ───────────────────────────────────────────────────────────────
output:
  required_elements:
    - compliance_confirmation: "AGENTS.md path and summary"
    - routing_confirmation: "Knowledge Base documents read (based on AGENTS.md routing)"
    - context_understanding: "Parsed [CONTEXT] with assumptions"
    - execution_approach: "How [REQUEST] will be handled per AGENTS.md + Knowledge Base"
    - next_actions: "Immediate next steps or results"

  delivery_location:
    primary: ./Export/
    filename_format: "[###] - [description].[extension]"
    note: "Use sequential numbering starting from 001. Check folder availability before creating output."